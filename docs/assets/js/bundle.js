const $=(()=>{const l={};async function u(i){const r={allowed_pages:"./data/allowed_pages.json",commands:"./data/commands.json",contact:"./data/contact.json",technologies:"./data/technologies.json",tokens:"./data/tokens.json"};if(!r[i])throw console.error("El archivo json no existe."),new Error("El archivo json no existe.");if(l[i])return l[i];try{const s=await fetch(r[i]);if(!s.ok)throw new Error(`Error HTTP: ${s.status}`);const o=await s.json();return l[i]=o,o}catch(s){throw console.error("Error al cargar el JSON:",s),s}}return{obtenerDataJson:u}})(),w=(()=>{function l(u,i="section"){$.obtenerDataJson("allowed_pages").then(r=>{const s=r.idDOMPermitidos,o=r.rutasPermitidas;if(!s.includes(i))throw console.error(`El ID '${i}' no está permitido.`),new Error(`El ID '${i}' no está permitido.`);if(!o[u])throw console.error(`El módulo '${u}' no está permitido.`),new Error(`El módulo '${u}' no está permitido.`);return fetch(o[u])}).then(r=>{if(!r.ok)throw new Error(`Error HTTP: ${r.status}`);return r.text()}).then(r=>{const s=document.getElementById(i);s.innerHTML=r;const o=new CustomEvent("moduloCargado",{detail:{modulo:u,idperm:i}});if(s.dispatchEvent(o),u==="inicio"){const a=document.getElementById("I_AM");a&&(window.innerWidth>=900&&(a.style.height=`${window.innerHeight-54}px`),N())}}).catch(r=>{throw console.error("Error al cargar el módulo:",r),r})}return{cargaModulo:l}})();function N(l="muestra_consola"){w.cargaModulo("consola",l);const u=document.getElementById(l);u.addEventListener("moduloCargado",function(i){if(i.detail.modulo==="consola"&&!u.querySelector(".consola_content")){console.log("consola no cargada ");return}},{once:!0})}function R(l){l.addEventListener("scroll",function(r){console.log(r)});const u={ArrowUp:"up",ArrowDown:"down"};if(l._listenerAgregado)return;l._listenerAgregado=!0,l.addEventListener("keydown",function(r){if(r.key==="ArrowUp"||r.key==="ArrowDown"){let s=i(r);y.comans(u[r.key],s[1])}if(r.key==="Enter"){let s=i(r);if(s[2]){const o=s[2].replace(/^root@Antonio_Segura:~#\s*/,"");o!=""?y.lexico(o).then(a=>{if(a.result===2){y.limpiaPantalla(r);return}y.insertaNuevoP(s[1],a.token)}):y.insertaNuevoP(s[1])}}});function i(r){r.preventDefault();const s=l.querySelectorAll("p"),o=s[s.length-1],a=o.id,g=o.innerText.trim();return{1:a,2:g}}}const y=(()=>{let l=[],u=[],i={},r=!1,s=!1,o=[],a={};const g=[];let f=-1;async function p(){if(r)return;if(s)return new Promise(t=>o.push(t));s=!0;const e=await $.obtenerDataJson("tokens");l=e.tokens,u=e.directorios,i=e.sintaxis,a=e.significado,r=!0,s=!1,o.forEach(t=>t()),o=[]}async function C(e){await p();const t=e.trim().split(/\s+/),n=[];g.push(e),f=g.length;for(let c=0;c<t.length;c++){const d=t[c].replace(/^\.(\/|\\)/,"");if(n.push(d),!l.includes(d))return{result:"-1",token:`'${t[c]}' no es un comando válido`}}return E(n,n.length)}function E(e,t){if(t===1)return Array.isArray(i[1])&&i[1].includes(e[0])?A(e,t):{result:"-1",token:`Comando inválido: '${e[0]}'`};if(t===2){if(!i.hasOwnProperty(e[0]))return{result:"-1",token:`Comando no reconocido: '${e[0]}'`};const n=i[e[0]];return Array.isArray(n)?n.includes(e[1])?A(e,t):{result:"-1",token:`Argumento inválido para '${e[0]}': '${e[1]}'`}:{result:"-1",token:`Configuración inválida para el comando: '${e[0]}'`}}return{result:"-1",token:"Error de sintaxis general"}}function A(e,t){if(t===1&&(e[0]==="--help"||e[0]==="/?")){const m=v();return{result:m.number,token:m.text}}if(t==2&&(e[1]==="--help"||e[1]==="/?")){const m=v(e[0]);return{result:m.number,token:m.text}}if(t==1&&(e[0]=="cls"||e[0]=="clear"))return{result:2,token:""};const n={ls:m=>P(m),cd:m=>D(),dir:m=>P(m),wget:m=>x(m)};let c="";(e[0]=="ls"||e[0]=="dir")&&(c="todos");const d=n[e[0]](t>1?e[1]:c);return{result:d.number,token:d.text}}function x(e){if(e==="cv"){const t="./document/Jose_Antonio_Rodriguez_Segura.pdf",n=document.createElement("a");return n.href=t,n.download="Jose_Antonio_Rodriguez_Segura.pdf",document.body.appendChild(n),n.click(),document.body.removeChild(n),{number:1,text:"Descargando curriculum vitae..."}}}function L(e,t="comand-0"){let n={up:-1,down:1}[e];if(f+=n,f<0)f=0;else if(f>=g.length)return f=g.length,"";b(t,g[f])}function b(e,t){const n=document.getElementById(e);n&&(n.textContent="root@Antonio_Segura:~# "+t,I(e))}function P(e="todos"){return e==="todos"?{number:1,text:u.join(`
`)}:u.includes(e)?{number:1,text:e}:{number:-1,text:`El directorio '${e}' no existe.`}}function v(e=""){let t="";if(e==="")for(const n in a){const c=a[n];t+=`> ${n}
`,Array.isArray(c)?t+=c.map(d=>`  ${d}`).join(`
`)+`

`:t+=`  ${c}

`}else{if(!a.hasOwnProperty(e))return{number:-1,text:`No hay información de ayuda para '${e}'`};const n=a[e];t+=`> ${e}
`,Array.isArray(n)?t+=n.map(c=>`  ${c}`).join(`
`):t+=`  ${n}`}return{number:3,text:t}}function D(e){return{number:4,text:""}}function M(e,t=""){let n=S(e);t!==""&&_(n,t)}function I(e){const t=document.getElementById(e);if(!t)return;t.focus&&t.focus();const n=document.createRange(),c=window.getSelection();n.selectNodeContents(t),n.collapse(!1),c.removeAllRanges(),c.addRange(n);const d=t.closest(".consola_content");if(!d)return;const m=t.getBoundingClientRect(),h=d.getBoundingClientRect();(m.bottom>h.bottom||m.top<h.top)&&(d.scrollTop=t.offsetTop-d.offsetTop)}function S(e,t="",n="~"){let c="";var d="";let m="afterend";if(t===""){if(d=document.getElementById(e),!d)return;d.classList.remove("prompt");const[T,j]=e.split("-"),B=parseInt(j)+1;c=`${T}-${B}`}else d=t.target,c="comand-0",m="afterbegin";const h=document.createElement("p");return h.className="prompt",h.id=c,h.textContent="root@Antonio_Segura:"+n+"# ",d.insertAdjacentElement(m,h),I(c),c}function _(e,t){const n=document.getElementById(e),c=document.createElement("span");c.textContent=t,n.insertAdjacentElement("beforebegin",c)}function k(e){e.target.innerHTML="",S("",e)}return{lexico:C,insertaNuevoP:M,limpiaPantalla:k,comans:L}})();window.agregarEventosInput=R;const q=(()=>{function l(o){const a=o.currentTarget.querySelectorAll("ul"),f=[".menu ul.menu-Principal",".menu ul.menu-flotante"][a.length-1],p=o.currentTarget.querySelector(f);p&&u(o,p,a.length-1==1)}function u(o,a,g=!1){const f=a.querySelectorAll("li"),p=o.target.closest("li");p&&a.contains(p)?i(f,p,g):r(o,a)}function i(o,a,g){try{const f=a.dataset.modulo||a.textContent.trim().toLowerCase();if(w.cargaModulo(f),o.forEach(p=>p.classList.remove("selected")),a.classList.add("selected"),g){const p=document.querySelector(".menu ul.menu-Principal");p&&p.querySelectorAll("li").forEach(E=>{E.classList.remove("selected"),(E.dataset.modulo||E.textContent.trim().toLowerCase())===f&&E.classList.add("selected")}),s()}}catch(f){alert(f)}}function r(o,a){if(s()==="cerrado")return;const g=document.createElement("ul");g.className="menu-flotante fadeInDown",a.querySelectorAll("li").forEach(p=>{g.appendChild(p.cloneNode(!0))}),o.target.insertAdjacentElement("afterend",g)}function s(){const o=document.querySelector(".menu-flotante");return o?(o.classList.remove("fadeInDown"),o.classList.add("fadeInUp-Menu"),setTimeout(()=>{o.remove()},750),"cerrado"):"continua"}return{menuActivo:l}})();document.addEventListener("DOMContentLoaded",()=>{w.cargaModulo("inicio"),document.getElementById("header").addEventListener("click",q.menuActivo)});
