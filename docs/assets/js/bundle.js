const S=(()=>{const l={};async function u(i){const o={allowed_pages:"./data/allowed_pages.json",commands:"./data/commands.json",contact:"./data/contact.json",technologies:"./data/technologies.json",tokens:"./data/tokens.json"};if(!o[i])throw console.error("El archivo json no existe."),new Error("El archivo json no existe.");if(l[i])return l[i];try{const s=await fetch(o[i]);if(!s.ok)throw new Error(`Error HTTP: ${s.status}`);const n=await s.json();return l[i]=n,n}catch(s){throw console.error("Error al cargar el JSON:",s),s}}return{obtenerDataJson:u}})();function B(l){l.addEventListener("scroll",function(o){console.log(o)});const u={ArrowUp:"up",ArrowDown:"down"};if(l._listenerAgregado)return;l._listenerAgregado=!0,l.addEventListener("keydown",function(o){if(o.key==="ArrowUp"||o.key==="ArrowDown"){let s=i(o);y.comans(u[o.key],s[1])}if(o.key==="Enter"){let s=i(o);if(s[2]){const n=s[2].replace(/^root@Antonio_Segura:~#\s*/,"");n!=""?y.lexico(n).then(a=>{if(a.result===2){y.limpiaPantalla(o);return}y.insertaNuevoP(s[1],a.token)}):y.insertaNuevoP(s[1])}}});function i(o){o.preventDefault();const s=l.querySelectorAll("p"),n=s[s.length-1],a=n.id,g=n.innerText.trim();return{1:a,2:g}}}const y=(()=>{let l=[],u=[],i={},o=!1,s=!1,n=[],a={};const g=[];let m=-1;async function p(){if(o)return;if(s)return new Promise(t=>n.push(t));s=!0;const e=await S.obtenerDataJson("tokens");l=e.tokens,u=e.directorios,i=e.sintaxis,a=e.significado,o=!0,s=!1,n.forEach(t=>t()),n=[]}async function C(e){await p();const t=e.trim().split(/\s+/),r=[];g.push(e),m=g.length;for(let c=0;c<t.length;c++){const d=t[c].replace(/^\.(\/|\\)/,"");if(r.push(d),!l.includes(d))return{result:"-1",token:`'${t[c]}' no es un comando válido`}}return E(r,r.length)}function E(e,t){if(t===1)return Array.isArray(i[1])&&i[1].includes(e[0])?A(e,t):{result:"-1",token:`Comando inválido: '${e[0]}'`};if(t===2){if(!i.hasOwnProperty(e[0]))return{result:"-1",token:`Comando no reconocido: '${e[0]}'`};const r=i[e[0]];return Array.isArray(r)?r.includes(e[1])?A(e,t):{result:"-1",token:`Argumento inválido para '${e[0]}': '${e[1]}'`}:{result:"-1",token:`Configuración inválida para el comando: '${e[0]}'`}}return{result:"-1",token:"Error de sintaxis general"}}function A(e,t){if(t===1&&(e[0]==="--help"||e[0]==="/?")){const f=I();return{result:f.number,token:f.text}}if(t==2&&(e[1]==="--help"||e[1]==="/?")){const f=I(e[0]);return{result:f.number,token:f.text}}if(t==1&&(e[0]=="cls"||e[0]=="clear"))return{result:2,token:""};const r={ls:f=>P(f),cd:f=>M(),dir:f=>P(f)};let c="";(e[0]=="ls"||e[0]=="dir")&&(c="todos");const d=r[e[0]](t>1?e[1]:c);return{result:d.number,token:d.text}}function x(e,t="comand-0"){let r={up:-1,down:1}[e];if(m+=r,m<0)m=0;else if(m>=g.length)return m=g.length,"";L(t,g[m])}function L(e,t){const r=document.getElementById(e);r&&(r.textContent="root@Antonio_Segura:~# "+t,$(e))}function P(e="todos"){return e==="todos"?{number:1,text:u.join(`
`)}:u.includes(e)?{number:1,text:e}:{number:-1,text:`El directorio '${e}' no existe.`}}function I(e=""){let t="";if(e==="")for(const r in a){const c=a[r];t+=`> ${r}
`,Array.isArray(c)?t+=c.map(d=>`  ${d}`).join(`
`)+`

`:t+=`  ${c}

`}else{if(!a.hasOwnProperty(e))return{number:-1,text:`No hay información de ayuda para '${e}'`};const r=a[e];t+=`> ${e}
`,Array.isArray(r)?t+=r.map(c=>`  ${c}`).join(`
`):t+=`  ${r}`}return{number:3,text:t}}function M(e){return{number:4,text:""}}function D(e,t=""){let r=v(e);t!==""&&b(r,t)}function $(e){const t=document.getElementById(e);if(!t)return;t.focus&&t.focus();const r=document.createRange(),c=window.getSelection();r.selectNodeContents(t),r.collapse(!1),c.removeAllRanges(),c.addRange(r);const d=t.closest(".consola_content");if(!d)return;console.log(d.scrollHeight);const f=t.getBoundingClientRect(),h=d.getBoundingClientRect();console.log(f,h),(f.bottom>h.bottom||f.top<h.top)&&(d.scrollTop=t.offsetTop-d.offsetTop)}function v(e,t="",r="~"){let c="";var d="";let f="afterend";if(t===""){if(d=document.getElementById(e),!d)return;d.classList.remove("prompt");const[_,j]=e.split("-"),k=parseInt(j)+1;c=`${_}-${k}`}else d=t.target,c="comand-0",f="afterbegin";const h=document.createElement("p");return h.className="prompt",h.id=c,h.textContent="root@Antonio_Segura:"+r+"# ",d.insertAdjacentElement(f,h),$(c),c}function b(e,t){const r=document.getElementById(e),c=document.createElement("span");c.textContent=t,r.insertAdjacentElement("beforebegin",c)}function T(e){e.target.innerHTML="",v("",e)}return{lexico:C,insertaNuevoP:D,limpiaPantalla:T,comans:x}})();window.agregarEventosInput=B;const w=(()=>{function l(u,i="section"){S.obtenerDataJson("allowed_pages").then(o=>{const s=o.idDOMPermitidos,n=o.rutasPermitidas;if(!s.includes(i))throw console.error(`El ID '${i}' no está permitido.`),new Error(`El ID '${i}' no está permitido.`);if(!n[u])throw console.error(`El módulo '${u}' no está permitido.`),new Error(`El módulo '${u}' no está permitido.`);return fetch(n[u])}).then(o=>{if(!o.ok)throw new Error(`Error HTTP: ${o.status}`);return o.text()}).then(o=>{const s=document.getElementById(i);s.innerHTML=o;const n=new CustomEvent("moduloCargado",{detail:{modulo:u,idperm:i}});if(s.dispatchEvent(n),u==="inicio"){const a=document.getElementById("I_AM");a&&(window.innerWidth>=900&&(a.style.height=`${window.innerHeight-54}px`),N())}}).catch(o=>{throw console.error("Error al cargar el módulo:",o),o})}return{cargaModulo:l}})();function N(l="muestra_consola"){w.cargaModulo("consola",l);const u=document.getElementById(l);u.addEventListener("moduloCargado",function(i){if(i.detail.modulo==="consola"&&!u.querySelector(".consola_content")){console.log("consola no cargada ");return}},{once:!0})}const q=(()=>{function l(n){const a=n.currentTarget.querySelectorAll("ul"),m=[".menu ul.menu-Principal",".menu ul.menu-flotante"][a.length-1],p=n.currentTarget.querySelector(m);p&&u(n,p,a.length-1==1)}function u(n,a,g=!1){const m=a.querySelectorAll("li"),p=n.target.closest("li");p&&a.contains(p)?i(m,p,g):o(n,a)}function i(n,a,g){try{const m=a.dataset.modulo||a.textContent.trim().toLowerCase();if(w.cargaModulo(m),n.forEach(p=>p.classList.remove("selected")),a.classList.add("selected"),g){const p=document.querySelector(".menu ul.menu-Principal");p&&p.querySelectorAll("li").forEach(E=>{E.classList.remove("selected"),(E.dataset.modulo||E.textContent.trim().toLowerCase())===m&&E.classList.add("selected")}),s()}}catch(m){alert(m)}}function o(n,a){if(s()==="cerrado")return;const g=document.createElement("ul");g.className="menu-flotante fadeInDown",a.querySelectorAll("li").forEach(p=>{g.appendChild(p.cloneNode(!0))}),n.target.insertAdjacentElement("afterend",g)}function s(){const n=document.querySelector(".menu-flotante");return n?(n.classList.remove("fadeInDown"),n.classList.add("fadeInUp-Menu"),setTimeout(()=>{n.remove()},750),"cerrado"):"continua"}return{menuActivo:l}})();document.addEventListener("DOMContentLoaded",()=>{w.cargaModulo("inicio"),document.getElementById("header").addEventListener("click",q.menuActivo)});
